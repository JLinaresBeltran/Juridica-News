# Visualization Specifications: Multi-Agent Health Insight System

## Overview
Visualizations in the Health Insight System are dynamically generated by the AI to best represent health data patterns and trends. Each visualization follows consistent design principles while adapting to the specific data being displayed.

## Core Visualization Types

### 1. Time Series Charts
Used for displaying health metrics over time (most common visualization type).

#### Visual Design
```css
/* Line styles */
--line-weight: 2px;
--line-weight-hover: 3px;
--point-size: 6px;
--point-size-hover: 8px;

/* Grid styles */
--grid-color: #E5E7EB;
--grid-opacity: 0.5;
--grid-stroke-dasharray: 2,2;

/* Reference ranges */
--reference-fill: rgba(34, 197, 94, 0.1);
--reference-stroke: #22C55E;
--reference-stroke-dasharray: 4,4;
```

#### Data Mapping
- **X-axis**: Always time (dates)
- **Y-axis**: Metric values with units
- **Lines**: Different metrics or categories
- **Areas**: Reference ranges or confidence intervals

#### Color Usage
```javascript
const metricColors = {
  totalCholesterol: '#3B82F6',  // Primary blue
  ldl: '#EF4444',              // Red (bad cholesterol)
  hdl: '#10B981',              // Green (good cholesterol)
  triglycerides: '#F59E0B',    // Amber
  glucose: '#8B5CF6',          // Purple
  bloodPressure: '#EC4899',    // Pink
  weight: '#06B6D4'            // Cyan
};
```

#### Interactions
- **Hover**: Show tooltip with exact values
- **Click**: Toggle metric visibility
- **Drag**: Create zoom selection
- **Touch**: Pan across time range
- **Pinch**: Zoom in/out on mobile

#### Example Configuration
```javascript
{
  chartType: 'line',
  title: '15-Year Cholesterol Trend Analysis',
  xAxis: {
    label: 'Date',
    type: 'time',
    format: 'MMM YYYY'
  },
  yAxis: {
    label: 'Cholesterol (mg/dL)',
    domain: [0, 300],
    referenceLines: [
      { value: 200, label: 'Borderline High', style: 'dashed' },
      { value: 240, label: 'High', style: 'dashed', color: '#EF4444' }
    ]
  },
  series: [
    { key: 'total', name: 'Total Cholesterol', color: '#3B82F6' },
    { key: 'ldl', name: 'LDL', color: '#EF4444' },
    { key: 'hdl', name: 'HDL', color: '#10B981' }
  ]
}
```

### 2. Correlation Scatter Plots
For showing relationships between two health metrics.

#### Visual Design
- Point size: 8px default, 10px on hover
- Opacity: 0.7 for overlapping points
- Trend line: 2px dashed line
- Confidence interval: Light fill area

#### Data Mapping
- **X-axis**: Independent variable (e.g., medication adherence)
- **Y-axis**: Dependent variable (e.g., lab results)
- **Color**: Time gradient or category
- **Size**: Optional third dimension

#### Statistical Overlays
```javascript
{
  showTrendLine: true,
  showConfidenceInterval: true,
  showRSquared: true,
  showCorrelationCoefficient: true,
  annotations: [
    { type: 'region', label: 'Target Range', ... }
  ]
}
```

### 3. Distribution Charts
For showing ranges and variations in health metrics.

#### Box Plot Design
- Box fill: Metric color at 20% opacity
- Median line: 3px solid
- Whiskers: 1px with end caps
- Outliers: Filled circles

#### Histogram Design
- Bar gap: 2px
- Bar radius: 4px top corners
- Gradient fill: Light to dark vertically
- Reference line overlays

### 4. Comparison Bar Charts
For comparing metrics across categories or time periods.

#### Visual Design
- Bar width: Dynamic based on count
- Bar spacing: 0.2 * bar width
- Corner radius: 4px
- Hover effect: 5% darker + shadow

#### Grouped Bar Configuration
```javascript
{
  groupMode: 'grouped', // or 'stacked'
  barPadding: 0.1,
  groupPadding: 0.2,
  showValues: true,
  valuePosition: 'top', // or 'inside'
  animation: {
    duration: 500,
    easing: 'easeOutQuart'
  }
}
```

### 5. Medication Timeline
Specialized visualization for medication history.

#### Visual Design
- Timeline height: 60px per medication
- Bar height: 40px
- Gap between medications: 20px
- Adherence indicator: Progress bar overlay

#### Timeline Elements
```css
.medication-bar {
  fill: var(--color-pharmacy);
  opacity: 0.8;
  stroke: var(--color-pharmacy);
  stroke-width: 1px;
}

.adherence-overlay {
  fill: url(#adherence-gradient);
  opacity: 0.6;
}

.dosage-change-marker {
  fill: var(--color-warning);
  r: 4px;
}
```

### 6. Multi-Metric Dashboard
Composite view showing multiple related visualizations.

#### Layout Patterns
```javascript
// 2x2 Grid
{
  layout: 'grid',
  columns: 2,
  gap: 16,
  charts: [
    { type: 'line', span: 2 },    // Full width
    { type: 'bar', span: 1 },     // Half width
    { type: 'scatter', span: 1 }  // Half width
  ]
}

// Vertical Stack
{
  layout: 'stack',
  gap: 24,
  syncAxis: true  // Synchronized time axis
}
```

## Interactive Features

### Tooltips
```javascript
{
  trigger: 'hover',
  position: 'auto', // Smart positioning
  delay: 100,
  content: {
    showDate: true,
    showValue: true,
    showUnit: true,
    showChange: true,    // Change from previous
    showReference: true  // Reference range
  },
  style: {
    background: 'rgba(0, 0, 0, 0.9)',
    border: '1px solid rgba(255, 255, 255, 0.1)',
    borderRadius: '6px',
    padding: '12px',
    fontSize: '13px',
    color: '#FFFFFF',
    boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)'
  }
}
```

### Zoom & Pan
```javascript
{
  zoom: {
    enabled: true,
    type: 'x', // or 'y' or 'xy'
    wheelEnabled: true,
    pinchEnabled: true,
    minZoom: 0.5,
    maxZoom: 10,
    resetButton: true
  },
  pan: {
    enabled: true,
    mode: 'x',
    rangeLimit: true
  }
}
```

### Legend
```javascript
{
  position: 'bottom', // or 'right' for many series
  layout: 'horizontal',
  align: 'center',
  itemGap: 20,
  interactive: true, // Click to toggle series
  style: {
    fontSize: '12px',
    itemPadding: '4px 8px',
    itemBorderRadius: '4px'
  }
}
```

## Responsive Behavior

### Desktop (>1200px)
- Full feature set enabled
- Hover interactions
- Detailed axes labels
- Complete legends

### Tablet (768-1200px)
- Touch-optimized interactions
- Simplified tooltips
- Abbreviated labels
- Scrollable legends

### Mobile (<768px)
- Tap for tooltips
- Pinch to zoom
- Horizontal scroll for wide charts
- Stacked layout for multi-charts
- Bottom sheet for details

## Accessibility Features

### Color Accessibility
```javascript
// Colorblind-friendly palette
const accessibleColors = {
  primary: '#3B82F6',    // Blue
  secondary: '#F59E0B',  // Orange
  tertiary: '#8B5CF6',   // Purple
  quaternary: '#10B981', // Teal
  // Avoid red-green combinations
};

// Pattern fills for differentiation
const patterns = [
  'solid',
  'dashed',
  'dotted',
  'dashDot'
];
```

### Screen Reader Support
```javascript
{
  ariaLabel: 'Cholesterol trend chart showing 15 years of data',
  ariaDescription: 'Line chart with time on x-axis and cholesterol values on y-axis',
  dataTable: true, // Generate accessible data table
  announceDataPoints: true
}
```

### Keyboard Navigation
- Tab: Navigate between chart elements
- Arrow keys: Move between data points
- Enter: Activate/deactivate series
- Escape: Close tooltips
- +/-: Zoom in/out

## Animation Specifications

### Entry Animations
```javascript
{
  animateOnMount: true,
  animationDuration: 800,
  animationEasing: 'easeOutQuart',
  animationDelay: (index) => index * 50, // Stagger
  
  // Line charts: Draw from left to right
  lineAnimation: {
    type: 'drawPath',
    duration: 1000
  },
  
  // Bar charts: Grow from bottom
  barAnimation: {
    type: 'growY',
    duration: 600
  }
}
```

### Update Animations
```javascript
{
  animateOnUpdate: true,
  updateDuration: 300,
  updateEasing: 'easeInOutQuad',
  
  // Smooth transitions between states
  interpolation: 'monotone',
  
  // Maintain object constancy
  dataKey: 'id'
}
```

## Export Options

### Image Export
```javascript
{
  formats: ['png', 'svg'],
  quality: 0.92,
  scale: 2, // For retina displays
  background: 'white',
  padding: 20
}
```

### Data Export
```javascript
{
  formats: ['csv', 'json'],
  includeHeaders: true,
  dateFormat: 'YYYY-MM-DD',
  numberFormat: '0.00'
}
```

## Performance Guidelines

### Data Limits
- Line charts: Max 500 points per series
- Scatter plots: Max 1000 total points
- Bar charts: Max 50 bars
- Use aggregation for larger datasets

### Optimization Techniques
```javascript
{
  // Simplify paths for performance
  simplifyPath: true,
  simplifyTolerance: 1,
  
  // Debounce interactions
  hoverDebounce: 50,
  resizeDebounce: 200,
  
  // Use canvas for large datasets
  renderer: dataPoints > 1000 ? 'canvas' : 'svg'
}
```

## Chart Component Template
```jsx
const HealthVisualization = ({ data, config }) => {
  return (
    <div className="visualization-container">
      <div className="chart-header">
        <h3>{config.title}</h3>
        <div className="chart-actions">
          <button>Export</button>
          <button>Fullscreen</button>
        </div>
      </div>
      
      <div className="chart-wrapper">
        <ResponsiveContainer width="100%" height={400}>
          <LineChart data={data} margin={{ top: 20, right: 30, left: 20, bottom: 50 }}>
            <CartesianGrid strokeDasharray="3 3" opacity={0.3} />
            <XAxis 
              dataKey="date" 
              tick={{ fontSize: 12 }}
              tickFormatter={dateFormatter}
            />
            <YAxis 
              label={{ value: config.yLabel, angle: -90, position: 'insideLeft' }}
              tick={{ fontSize: 12 }}
            />
            <Tooltip content={<CustomTooltip />} />
            <Legend />
            {config.series.map(series => (
              <Line
                key={series.key}
                type="monotone"
                dataKey={series.key}
                stroke={series.color}
                strokeWidth={2}
                dot={{ r: 4 }}
                activeDot={{ r: 6 }}
              />
            ))}
            <ReferenceArea
              y1={config.referenceRange.min}
              y2={config.referenceRange.max}
              fill="#10B981"
              fillOpacity={0.1}
            />
          </LineChart>
        </ResponsiveContainer>
      </div>
      
      <div className="chart-insights">
        <p>{config.insight}</p>
      </div>
    </div>
  );
};
```

## Medical-Specific Considerations

### Reference Ranges
Always display normal/target ranges when applicable:
- Green band for normal range
- Yellow for borderline
- Red for critical values

### Clinical Significance
- Highlight clinically significant changes
- Show percentage change for context
- Include units consistently
- Provide interpretation hints

### Privacy & Security
- No patient identifiers in exports
- Watermark for draft/unofficial
- Audit trail for data access
- Secure sharing options